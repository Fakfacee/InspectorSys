"use strict";(self["webpackChunkinspector_sys"]=self["webpackChunkinspector_sys"]||[]).push([[303],{303:function(e,l,a){a.r(l),a.d(l,{default:function(){return y}});var t=a(3396),o=a(4870),n=a(7139),u=a(2748),i=a(1298);function d(){return(0,i.Z)({url:"databaseget",method:"get"})}function r(e){return(0,i.Z)({url:"tableDataChange",method:"post",data:e})}function p(e){return(0,i.Z)({url:"deletetableimf",method:"post",data:e})}function c(e){return(0,i.Z)({url:"uploadtableimf",method:"post",data:e,headers:{"Content-Type":"mutipart/form-data"}})}var m=a(7178),s=a(6e3),w=a(6666),f=a(2261),v=a(7947);const W=e=>((0,t.dD)("data-v-ccd5467c"),e=e(),(0,t.Cn)(),e),g={class:"table-block"},U={class:"dialog-footer"},_=W((()=>(0,t._)("div",{class:"el-upload__tip"},"仅能上传xlsx文件",-1)));var D={__name:"index",setup(e){const l=(0,o.qj)({tableData:[],formData:{DrawingNo:"",WeldNo:"",PipeNo:"",Size:"",MaterialId:"",ZuDuiDate:[],ZuDuiInspectDate:[],WeldingDate:[],AppearanceInspectDate:[],AppearanceResult:""},formRules:{DrawingNo:[{required:!0,message:"请输入图纸号",trigger:"blur"}],WeldNo:[{required:!0,message:"请输入焊口号",trigger:"blur"}]},uploadForm:{user:"test"},downLoadTableData:[{name:"DWR",key:"downloaddwrfile"},{name:"焊口信息汇总表",key:"downloadsumfile"},{name:"VT信息",key:"downloadvtfile"}]}),{tableData:a,formData:W,uploadForm:D,downLoadTableData:h}=(0,o.BK)(l),b=(0,o.iH)([]),y=(0,o.iH)(1),S=(0,o.iH)(10),k=(0,o.iH)(null),V=(0,o.iH)(!1);async function N(){V.value=!0,await d().then((e=>200===e.status?(b.value=e.data,C(),Promise.resolve()):Promise.reject(e))).catch((e=>{m.z8.error(e),console.log(e)})),V.value=!1}N();const x=(0,o.iH)(void 0);function C(e){x.value||(x.value=e);let l=x.value?x.value:b.value;a.value=l.slice((y.value-1)*S.value,y.value*S.value),k.value=l.length}function I(e){y.value=e,C()}function H(e){S.value=e,y.value=1,C()}const z=(0,o.iH)(void 0),B=(0,o.iH)(null),E=(0,o.iH)(!1);function T(e){z.value="修改表单",E.value=!0;const l=JSON.parse(JSON.stringify(e));W.value=l,B.value=l}function Z(e){s.T.confirm(`确定要删除图纸号为${e.DrawingNo||P.value.map((e=>e.DrawingNo))}的数据吗？`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{p({tableData:e}).then((e=>{console.log(e),(0,m.z8)({type:"success",message:"删除成功"})})).catch((e=>{console.log(e)}))})).catch((()=>{}))}const A=(0,o.iH)(void 0);function M(){x.value=null,console.log(A.value,"queryDAta");let e=b.value.filter((e=>e.DrawingNo==A.value||e.DrawingNo.includes(A.value)));a.value=e,k.value=e.length,C(e)}function R(){A.value=void 0,x.value=null,N()}const P=(0,o.iH)([]);function $(e,l){P.value=e}function j(e){P.value=e}function Y(){z.value="新增表单",E.value=!0,W.value={DrawingNo:"",WeldNo:"",PipeNo:"",Size:"",MaterialId:"",ZuDuiDate:[],ZuDuiInspectDate:[],WeldingDate:[],AppearanceInspectDate:[],AppearanceResult:""}}const q=(0,o.iH)(),F=(0,o.iH)(!1);async function L(e){e&&await e.validate((async(e,l)=>{if(e){const e=(0,o.IU)(W.value);e.editable=!0;for(const l in e)e[l]!==B.value[l]?e[l+"_edible"]=!0:e[l+"_edible"]=!1;e.type="edit";try{F.value=!0;let l=await r({tableData:e});m.z8.success(l.data.Note),F.value=!1,E.value=!1,N()}catch(a){console.log(a),m.z8.error(a)}}else console.log("error submit!",l)}))}const J=(0,o.iH)(!1);function O(){J.value=!0}function Q(e){ue.value?s.T.confirm(`是否下载截至时间为${ue.value[0]}至${ue.value[1]}的${e.name}数据?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let l={StartDate:ue.value[0],EndDate:ue.value[1]};(0,i.W)(e.key,`summary_${(new Date).toLocaleDateString("zh-CN",{year:"2-digit",month:"2-digit",day:"2-digit"})}.xlsx`,JSON.stringify(l))})).catch((()=>{})):(0,i.W)(e.key,`summary_${(new Date).toLocaleDateString("zh-CN",{year:"2-digit",month:"2-digit",day:"2-digit"})}.xlsx`)}const G=(0,o.iH)(!1);function K(){G.value=!0}const X=(0,o.iH)(),ee=(0,o.iH)([]);function le(e){X.value=e;let l=e.name.split(".");return"xls"===l[1]||"xlsx"===l[1]||"csv"===l[1]?e:((0,w.bM)({title:"上传失败",message:"仅能上传excel格式文件！",type:"error"}),ee.value=[],X.value="",!1)}function ae(){(0,w.bM)({title:"上传失败",message:"单次仅能上传一个文件！",type:"error"})}const te=(0,o.iH)(!1),oe=(0,o.iH)();function ne(){if(!X.value)return void m.z8.error("上传文件不能为空！");te.value=!0,console.log(X.value);let e=new FormData;e.append("file",X.value.raw),e.append("user","test"),c(e).then((e=>{console.log(e),(0,w.bM)({title:"上传成功",message:`${e.data.Note}`,type:"success"}),te.value=!1,ee.value=[],X.value=""})).catch((e=>{(0,w.bM)({title:"上传失败",message:`${e.data.Note}`,type:"error"})}))}const ue=(0,o.iH)(),ie=[{text:"上周",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-6048e5),[l,e]}},{text:"上个月",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-2592e6),[l,e]}},{text:"3个月之前",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-7776e6),[l,e]}}];function de(e){return e.getTime()>Date.now()}return(e,i)=>{const d=(0,t.up)("el-input"),r=(0,t.up)("el-form-item"),p=(0,t.up)("el-form"),c=(0,t.up)("el-col"),m=(0,t.up)("el-table-column"),s=(0,t.up)("el-table"),w=(0,t.up)("el-pagination"),D=(0,t.up)("el-row"),b=(0,t.up)("el-option"),N=(0,t.up)("el-select"),x=(0,t.up)("el-date-picker"),C=(0,t.up)("el-radio"),B=(0,t.up)("el-radio-group"),X=(0,t.up)("el-upload"),re=(0,t.up)("el-alert"),pe=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(D,{gutter:30},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{inline:!0,"label-width":"55px"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"单管号"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{clearable:"",style:{width:"230px"},modelValue:A.value,"onUpdate:modelValue":i[0]||(i[0]=e=>A.value=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.olm),type:"primary",onClick:M},{default:(0,t.w5)((()=>[(0,t.Uk)("搜索")])),_:1},8,["icon"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.Ufu),onClick:R},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1},8,["icon"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.v37),plain:"",type:"primary",onClick:Y},{default:(0,t.w5)((()=>[(0,t.Uk)("新增")])),_:1},8,["icon"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.I8b),plain:"",type:"success",disabled:!(1==P.value.length),onClick:i[1]||(i[1]=e=>T(P.value[0]))},{default:(0,t.w5)((()=>[(0,t.Uk)("修改")])),_:1},8,["icon","disabled"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.HG3),plain:"",type:"danger",disabled:!(P.value.length>=1),onClick:Z},{default:(0,t.w5)((()=>[(0,t.Uk)("删除")])),_:1},8,["icon","disabled"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.UWx),plain:"",type:"success",onClick:O},{default:(0,t.w5)((()=>[(0,t.Uk)("数据下载")])),_:1},8,["icon"]),(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.AQM),plain:"",type:"primary",onClick:K},{default:(0,t.w5)((()=>[(0,t.Uk)("图纸上传")])),_:1},8,["icon"])])),_:1}),(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t._)("div",g,[(0,t.wy)(((0,t.wg)(),(0,t.j4)(s,{data:(0,o.SU)(a),"element-loading-text":"加载中...",onSelect:$,onSelectAll:j,height:"750"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{type:"selection",width:"55"}),(0,t.Wm)(m,{type:"index",width:"55",label:"序号",align:"center"}),(0,t.Wm)(m,{label:"图纸号","show-overflow-tooltip":"",align:"center",prop:"DrawingNo",width:"220"}),(0,t.Wm)(m,{label:"焊口号","show-overflow-tooltip":"",prop:"WeldNo",align:"center",width:"80"}),(0,t.Wm)(m,{label:"单管号","show-overflow-tooltip":"",prop:"PipeNo",align:"center",width:"220"}),(0,t.Wm)(m,{label:"管径","show-overflow-tooltip":"",prop:"Size",align:"center",width:"55"}),(0,t.Wm)(m,{label:"材质","show-overflow-tooltip":"",prop:"MaterialId",align:"center",width:"55"}),(0,t.Wm)(m,{label:"组对日期","show-overflow-tooltip":"",prop:"ZuDuiDate",align:"center"}),(0,t.Wm)(m,{label:"组队检验日期","show-overflow-tooltip":"",prop:"ZuDuiInspectDate",align:"center"}),(0,t.Wm)(m,{label:"焊接日期","show-overflow-tooltip":"",prop:"WeldingDate",align:"center"}),(0,t.Wm)(m,{label:"外观检验日期","show-overflow-tooltip":"",prop:"AppearanceInspectDate",align:"center"}),(0,t.Wm)(m,{label:"外观检验结果","show-overflow-tooltip":"",prop:"AppearanceResult",align:"center",width:"120"}),(0,t.Wm)(m,{label:"操作",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:"Edit",link:"",type:"primary",disabled:0==e.row.isExchange,onClick:l=>T(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("修改 ")])),_:2},1032,["disabled","onClick"]),(0,t.Wm)((0,o.SU)(f.ElButton),{icon:"Delete",link:"",type:"primary",disabled:0==e.row.isExchange,onClick:l=>Z(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("删除 ")])),_:2},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"])),[[pe,V.value]]),(0,t.Wm)(w,{"current-page":y.value,"onUpdate:currentPage":i[2]||(i[2]=e=>y.value=e),"page-size":S.value,"onUpdate:pageSize":i[3]||(i[3]=e=>S.value=e),"page-sizes":[10,20,50,100],small:e.small,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:k.value,onSizeChange:H,onCurrentChange:I,style:{"margin-top":"20px"}},null,8,["current-page","page-size","small","total"])])])),_:1})])),_:1}),(0,t.Wm)((0,o.SU)(v.d0),{modelValue:E.value,"onUpdate:modelValue":i[16]||(i[16]=e=>E.value=e),title:z.value,width:"30%"},{footer:(0,t.w5)((()=>[(0,t._)("span",U,[(0,t.Wm)((0,o.SU)(f.ElButton),{onClick:i[14]||(i[14]=e=>E.value=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)((0,o.SU)(f.ElButton),{type:"primary",onClick:i[15]||(i[15]=e=>L(q.value)),loading:F.value},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存 ")])),_:1},8,["loading"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref_key:"ruleFormRef",ref:q,model:(0,o.SU)(W),"label-width":"100px",rules:l.formRules},{default:(0,t.w5)((()=>[(0,t.Wm)(D,null,{default:(0,t.w5)((()=>[(0,t.Wm)(c,{span:20},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"图纸号",prop:"DrawingNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(W).DrawingNo,"onUpdate:modelValue":i[4]||(i[4]=e=>(0,o.SU)(W).DrawingNo=e),placeholder:"请输入图纸号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"焊口号",prop:"WeldNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(W).WeldNo,"onUpdate:modelValue":i[5]||(i[5]=e=>(0,o.SU)(W).WeldNo=e),placeholder:"请输入焊口号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"管径",prop:"Size"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(W).Size,"onUpdate:modelValue":i[6]||(i[6]=e=>(0,o.SU)(W).Size=e),placeholder:"请输入管径"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"材质",prop:"MaterialId"},{default:(0,t.w5)((()=>[(0,t.Wm)(N,{modelValue:(0,o.SU)(W).MaterialId,"onUpdate:modelValue":i[7]||(i[7]=e=>(0,o.SU)(W).MaterialId=e),placeholder:"请选择材质"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{label:"CS",value:"CS"}),(0,t.Wm)(b,{label:"SS",value:"SS"}),(0,t.Wm)(b,{label:"CU/NI",value:"CU/NI"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:20},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"单管号",prop:"PipeNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(W).PipeNo,"onUpdate:modelValue":i[8]||(i[8]=e=>(0,o.SU)(W).PipeNo=e),placeholder:"请输入单管号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"组对日期",prop:"ZuDuiDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(W).ZuDuiDate,"onUpdate:modelValue":i[9]||(i[9]=e=>(0,o.SU)(W).ZuDuiDate=e),type:"date",placeholder:"请选择组对日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"组对检验日期",prop:"ZuDuiInspectDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(W).ZuDuiInspectDate,"onUpdate:modelValue":i[10]||(i[10]=e=>(0,o.SU)(W).ZuDuiInspectDate=e),type:"date",placeholder:"请选择组对检验日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"焊接日期",prop:"WeldingDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(W).WeldingDate,"onUpdate:modelValue":i[11]||(i[11]=e=>(0,o.SU)(W).WeldingDate=e),type:"date",placeholder:"请选择焊接日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"外观检验日期",prop:"AppearanceInspectDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(W).AppearanceInspectDate,"onUpdate:modelValue":i[12]||(i[12]=e=>(0,o.SU)(W).AppearanceInspectDate=e),type:"date",placeholder:"请选择外观检验日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"外观检验结果",prop:"AppearanceResult"},{default:(0,t.w5)((()=>[(0,t.Wm)(B,{modelValue:(0,o.SU)(W).AppearanceResult,"onUpdate:modelValue":i[13]||(i[13]=e=>(0,o.SU)(W).AppearanceResult=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{border:"",label:1},{default:(0,t.w5)((()=>[(0,t.Uk)("合格")])),_:1}),(0,t.Wm)(C,{border:"",label:2},{default:(0,t.w5)((()=>[(0,t.Uk)("不合格")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,t.Wm)((0,o.SU)(v.d0),{class:"uploadDialog",modelValue:G.value,"onUpdate:modelValue":i[17]||(i[17]=e=>G.value=e),title:"图纸上传"},{footer:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{type:"success",onClick:ne,loading:te.value},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(te.value?"上传中...":"上传服务器"),1)])),_:1},8,["loading"])])),default:(0,t.w5)((()=>[(0,t.Wm)(X,{ref_key:"uploadRef",ref:oe,class:"upload-demo","on-change":le,"on-exceed":ae,"list-type":"picture","auto-upload":!1,limit:"1","file-list":ee.value},{trigger:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("选取文件")])),_:1})])),tip:(0,t.w5)((()=>[_])),_:1},8,["file-list"])])),_:1},8,["modelValue"]),(0,t.Wm)((0,o.SU)(v.d0),{modelValue:J.value,"onUpdate:modelValue":i[19]||(i[19]=e=>J.value=e),title:"数据下载",width:"600"},{default:(0,t.w5)((()=>[(0,t.Wm)(D,{justify:e.center},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{inline:!0},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"时间范围"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:ue.value,"onUpdate:modelValue":i[18]||(i[18]=e=>ue.value=e),type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:ie,"value-format":"YYYY-MM-DD","disabled-date":de},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(re,{title:"时间范围为空时，下载全部数据！",type:"warning","show-icon":"",closable:!1})])),_:1}),(0,t.Wm)(c,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{data:(0,o.SU)(h)},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{label:"数据名称",prop:"name","show-overflow-tooltip":"",align:"center"}),(0,t.Wm)(m,{label:"操作",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)((0,o.SU)(f.ElButton),{link:"",icon:(0,o.SU)(u.UWx),type:"primary",onClick:l=>Q(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("下载 ")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1},8,["justify"])])),_:1},8,["modelValue"])],64)}}},h=a(89);const b=(0,h.Z)(D,[["__scopeId","data-v-ccd5467c"]]);var y=b}}]);
//# sourceMappingURL=303.b4e00240.js.map