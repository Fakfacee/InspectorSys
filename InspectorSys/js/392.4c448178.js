"use strict";(self["webpackChunkinspector_sys"]=self["webpackChunkinspector_sys"]||[]).push([[392],{4392:function(e,l,a){a.r(l),a.d(l,{default:function(){return y}});var t=a(3396),o=a(4870),n=a(7139),u=a(2748),i=a(9583);function d(){return(0,i.Z)({url:"databaseget",method:"get"})}function r(e){return(0,i.Z)({url:"tableDataChange",method:"post",data:e})}function p(e){return(0,i.Z)({url:"deletetableimf",method:"post",data:e})}function s(e,l){return(0,i.Z)({url:l,method:"post",data:e,headers:{"Content-Type":"mutipart/form-data"},timeout:12e4})}var c=a(7178),m=a(6e3),w=a(6666),f=a(2261),v=a(7947);function g(e){const l=e.getFullYear(),a=e.getMonth()+1,t=e.getDate(),o=l+"-"+a+"-"+t;return o}const W=e=>((0,t.dD)("data-v-4c4fa5c9"),e=e(),(0,t.Cn)(),e),U={class:"table-block"},D={class:"dialog-footer"},_=W((()=>(0,t._)("div",{class:"el-upload__tip"},"仅能上传xlsx文件",-1)));var h={__name:"index",setup(e){const l=sessionStorage.getItem("roles"),a=(0,o.qj)({tableData:[],formData:{DrawingNo:"",WeldNo:"",PipeNo:"",Size:"",MaterialId:"",ZuDuiDate:[],ZuDuiInspectDate:[],WeldingDate:[],AppearanceInspectDate:[],AppearanceResult:"",Contractor:"",Fitter:"",Inspector:"",JointType:"",Location:"",ModuleNo:"",Thickness:"",WPS:"",WeldId:"",WelderNo:"",WorkPackage:"",ZuDuiId:"",ZuDuiResult:""},formRules:{DrawingNo:[{required:!0,message:"请输入图纸号",trigger:"blur"}],WeldNo:[{required:!0,message:"请输入焊口号",trigger:"blur"}]},uploadForm:{user:"test"},downLoadTableData:[{name:"DWR",key:"downloaddwrfile"},{name:"焊口信息表",key:"downloadsumfile"},{name:"VT信息",key:"downloadvtfile"}]}),{tableData:W,formData:h,uploadForm:S,downLoadTableData:b}=(0,o.BK)(a),y=(0,o.iH)([]),k=(0,o.iH)(1),V=(0,o.iH)(10),N=(0,o.iH)(null),C=(0,o.iH)(!1);async function x(){C.value=!0,await d().then((e=>200===e.status?(y.value=e.data,H(),Promise.resolve()):Promise.reject(e))).catch((e=>{c.z8.error(e),console.log(e)})),C.value=!1}x();const I=(0,o.iH)(void 0);function H(e){I.value||(I.value=e);let l=I.value?I.value:y.value;W.value=l.slice((k.value-1)*V.value,k.value*V.value),N.value=l.length}function M(e){k.value=e,H()}function Y(e){V.value=e,k.value=1,H()}const z=(0,o.iH)(void 0),T=(0,o.iH)(null),B=(0,o.iH)(!1);function E(e){z.value="修改表单",B.value=!0;const l=JSON.parse(JSON.stringify(e));h.value=l,T.value=l}function Z(e){m.T.confirm(`确定要删除图纸号为${e.DrawingNo||P.value.map((e=>e.DrawingNo))}的数据吗？`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{p({tableData:e}).then((e=>{console.log(e),(0,c.z8)({type:"success",message:"删除成功"})})).catch((e=>{console.log(e)}))})).catch((()=>{}))}const A=(0,o.iH)(void 0);function R(){I.value=null,console.log(A.value,"queryDAta");let e=y.value.filter((e=>e.DrawingNo==A.value||e.DrawingNo.includes(A.value)));W.value=e,N.value=e.length,H(e)}function j(){A.value=void 0,I.value=null,x()}const P=(0,o.iH)([]);function $(e,l){P.value=e}function q(e){P.value=e}const F=(0,o.iH)(),J=(0,o.iH)(!1);async function L(e){e&&await e.validate((async(e,l)=>{if(e){const e=(0,o.IU)(h.value);console.log(h.value);try{J.value=!0;let l=await r({tableData:e});c.z8.success(l.data.Note),J.value=!1,B.value=!1,x()}catch(a){console.log(a),c.z8.error(a)}}else console.log("error submit!",l)}))}const O={StartDate:g(new Date(2e3,1,1)),EndDate:g(new Date(Date.now()))},Q=(0,o.iH)(!1);function G(){Q.value=!0}function K(e){if(de.value)m.T.confirm(`是否下载截至时间为${de.value[0]}至${de.value[1]}的${e.name}数据?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let l={StartDate:de.value[0],EndDate:de.value[1]};console.log(l,"选定时间范围"),(0,i.W)(e.key,`${e.name}_${(new Date).toLocaleDateString("zh-CN",{year:"2-digit",month:"2-digit",day:"2-digit"})}.xlsx`,JSON.stringify(l))})).catch((()=>{}));else{if("downloadvtfile"==e.key)return void c.z8.error("请选择时间范围");console.log(O,"默认时间"),(0,i.W)(e.key,`${e.name}_${(new Date).toLocaleDateString("zh-CN",{year:"2-digit",month:"2-digit",day:"2-digit"})}.xlsx`,JSON.stringify(O))}}const X=(0,o.iH)(!1);function ee(){X.value=!0}const le=(0,o.iH)(),ae=(0,o.iH)([]);function te(e){le.value=e;let l=e.name.split(".");return"xls"===l[1]||"xlsx"===l[1]||"csv"===l[1]?e:((0,w.bM)({title:"上传失败",message:"仅能上传excel格式文件！",type:"error"}),ae.value=[],le.value="",!1)}function oe(){(0,w.bM)({title:"上传失败",message:"单次仅能上传一个文件！",type:"error"})}const ne=(0,o.iH)(!1),ue=(0,o.iH)();function ie(e){if(!le.value)return void c.z8.error("上传文件不能为空！");ne.value=!0;let l=new FormData;l.append("file",le.value.raw),l.append("user","test"),s(l,e).then((e=>{(0,w.bM)({title:"上传成功",message:`${e.data.Note}`,type:"success"}),ne.value=!1,ae.value=[],le.value=""})).catch((e=>{(0,w.bM)({title:"上传失败",message:"错误，请联系管理员",type:"error"})}))}const de=(0,o.iH)(),re=[{text:"上周",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-6048e5),[l,e]}},{text:"上个月",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-2592e6),[l,e]}},{text:"3个月之前",value:()=>{const e=new Date,l=new Date;return l.setTime(l.getTime()-7776e6),[l,e]}}];function pe(e){return e.getTime()>Date.now()}return(e,i)=>{const d=(0,t.up)("el-input"),r=(0,t.up)("el-form-item"),p=(0,t.up)("el-form"),s=(0,t.up)("el-col"),c=(0,t.up)("el-table-column"),m=(0,t.up)("el-table"),w=(0,t.up)("el-pagination"),g=(0,t.up)("el-row"),S=(0,t.up)("el-option"),y=(0,t.up)("el-select"),x=(0,t.up)("el-date-picker"),I=(0,t.up)("el-radio"),H=(0,t.up)("el-radio-group"),T=(0,t.up)("el-upload"),O=(0,t.up)("el-alert"),le=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(g,{gutter:30},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{inline:!0,"label-width":"55px"},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"单管号"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{clearable:"",style:{width:"230px"},modelValue:A.value,"onUpdate:modelValue":i[0]||(i[0]=e=>A.value=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.olm),type:"primary",onClick:R},{default:(0,t.w5)((()=>[(0,t.Uk)("搜索")])),_:1},8,["icon"])])),_:1}),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.Ufu),onClick:j},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1},8,["icon"])])),_:1}),1==(0,o.SU)(l)?((0,t.wg)(),(0,t.j4)(r,{key:0},{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.I8b),plain:"",type:"success",disabled:!(1==P.value.length),onClick:i[1]||(i[1]=e=>E(P.value[0]))},{default:(0,t.w5)((()=>[(0,t.Uk)("修改")])),_:1},8,["icon","disabled"])])),_:1})):(0,t.kq)("",!0),1==(0,o.SU)(l)?((0,t.wg)(),(0,t.j4)(r,{key:1},{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.HG3),plain:"",type:"danger",disabled:!(P.value.length>=1),onClick:Z},{default:(0,t.w5)((()=>[(0,t.Uk)("删除")])),_:1},8,["icon","disabled"])])),_:1})):(0,t.kq)("",!0),(0,t.Wm)(r,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.UWx),plain:"",type:"success",onClick:G},{default:(0,t.w5)((()=>[(0,t.Uk)("数据下载")])),_:1},8,["icon"])])),_:1}),1==(0,o.SU)(l)?((0,t.wg)(),(0,t.j4)(r,{key:2},{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:(0,o.SU)(u.AQM),plain:"",type:"primary",onClick:ee},{default:(0,t.w5)((()=>[(0,t.Uk)("图纸上传/升版")])),_:1},8,["icon"])])),_:1})):(0,t.kq)("",!0)])),_:1})])),_:1}),(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t._)("div",U,[(0,t.wy)(((0,t.wg)(),(0,t.j4)(m,{data:(0,o.SU)(W),"element-loading-text":"加载中...",onSelect:$,onSelectAll:q,height:"750"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{type:"selection",width:"55"}),(0,t.Wm)(c,{type:"index",width:"55",label:"序号",align:"center"}),(0,t.Wm)(c,{label:"图纸号","show-overflow-tooltip":"",align:"center",prop:"DrawingNo",width:"220"}),(0,t.Wm)(c,{label:"焊口号","show-overflow-tooltip":"",prop:"WeldNo",align:"center",width:"80"}),(0,t.Wm)(c,{label:"单管号","show-overflow-tooltip":"",prop:"PipeNo",align:"center",width:"220"}),(0,t.Wm)(c,{label:"管径","show-overflow-tooltip":"",prop:"Size",align:"center",width:"55"}),(0,t.Wm)(c,{label:"材质","show-overflow-tooltip":"",prop:"MaterialId",align:"center",width:"55"}),(0,t.Wm)(c,{label:"组对日期","show-overflow-tooltip":"",prop:"ZuDuiDate",align:"center"}),(0,t.Wm)(c,{label:"组队检验日期","show-overflow-tooltip":"",prop:"ZuDuiInspectDate",align:"center"}),(0,t.Wm)(c,{label:"焊接日期","show-overflow-tooltip":"",prop:"WeldingDate",align:"center"}),(0,t.Wm)(c,{label:"外观检验日期","show-overflow-tooltip":"",prop:"AppearanceInspectDate",align:"center"}),(0,t.Wm)(c,{label:"外观检验结果","show-overflow-tooltip":"",prop:"AppearanceResult",align:"center",width:"120"}),1==(0,o.SU)(l)?((0,t.wg)(),(0,t.j4)(c,{key:0,label:"操作",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)((0,o.SU)(f.ElButton),{icon:"Edit",link:"",type:"primary",disabled:0==e.row.isExchange,onClick:l=>E(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("修改 ")])),_:2},1032,["disabled","onClick"]),(0,t.Wm)((0,o.SU)(f.ElButton),{icon:"Delete",link:"",type:"primary",disabled:0==e.row.isExchange,onClick:l=>Z(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("删除 ")])),_:2},1032,["disabled","onClick"])])),_:1})):(0,t.kq)("",!0)])),_:1},8,["data"])),[[le,C.value]]),(0,t.Wm)(w,{"current-page":k.value,"onUpdate:currentPage":i[2]||(i[2]=e=>k.value=e),"page-size":V.value,"onUpdate:pageSize":i[3]||(i[3]=e=>V.value=e),"page-sizes":[10,20,50,100],small:e.small,background:!0,layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:Y,onCurrentChange:M,style:{"margin-top":"20px"}},null,8,["current-page","page-size","small","total"])])])),_:1})])),_:1}),(0,t.Wm)((0,o.SU)(v.d0),{modelValue:B.value,"onUpdate:modelValue":i[16]||(i[16]=e=>B.value=e),title:z.value,width:"30%"},{footer:(0,t.w5)((()=>[(0,t._)("span",D,[(0,t.Wm)((0,o.SU)(f.ElButton),{onClick:i[14]||(i[14]=e=>B.value=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)((0,o.SU)(f.ElButton),{type:"primary",onClick:i[15]||(i[15]=e=>L(F.value)),loading:J.value},{default:(0,t.w5)((()=>[(0,t.Uk)(" 保存 ")])),_:1},8,["loading"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(p,{ref_key:"ruleFormRef",ref:F,model:(0,o.SU)(h),"label-width":"100px",rules:a.formRules},{default:(0,t.w5)((()=>[(0,t.Wm)(g,null,{default:(0,t.w5)((()=>[(0,t.Wm)(s,{span:20},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"图纸号",prop:"DrawingNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(h).DrawingNo,"onUpdate:modelValue":i[4]||(i[4]=e=>(0,o.SU)(h).DrawingNo=e),placeholder:"请输入图纸号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"焊口号",prop:"WeldNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(h).WeldNo,"onUpdate:modelValue":i[5]||(i[5]=e=>(0,o.SU)(h).WeldNo=e),placeholder:"请输入焊口号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"管径",prop:"Size"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(h).Size,"onUpdate:modelValue":i[6]||(i[6]=e=>(0,o.SU)(h).Size=e),placeholder:"请输入管径"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:12},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"材质",prop:"MaterialId"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:(0,o.SU)(h).MaterialId,"onUpdate:modelValue":i[7]||(i[7]=e=>(0,o.SU)(h).MaterialId=e),placeholder:"请选择材质"},{default:(0,t.w5)((()=>[(0,t.Wm)(S,{label:"CS",value:"CS"}),(0,t.Wm)(S,{label:"SS",value:"SS"}),(0,t.Wm)(S,{label:"CU/NI",value:"CU/NI"})])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:20},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"单管号",prop:"PipeNo"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{modelValue:(0,o.SU)(h).PipeNo,"onUpdate:modelValue":i[8]||(i[8]=e=>(0,o.SU)(h).PipeNo=e),placeholder:"请输入单管号"},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"组对日期",prop:"ZuDuiDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(h).ZuDuiDate,"onUpdate:modelValue":i[9]||(i[9]=e=>(0,o.SU)(h).ZuDuiDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择组对日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"组对检验日期",prop:"ZuDuiInspectDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(h).ZuDuiInspectDate,"onUpdate:modelValue":i[10]||(i[10]=e=>(0,o.SU)(h).ZuDuiInspectDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择组对检验日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"焊接日期",prop:"WeldingDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(h).WeldingDate,"onUpdate:modelValue":i[11]||(i[11]=e=>(0,o.SU)(h).WeldingDate=e),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择焊接日期",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:16},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"外观检验日期",prop:"AppearanceInspectDate"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:(0,o.SU)(h).AppearanceInspectDate,"onUpdate:modelValue":i[12]||(i[12]=e=>(0,o.SU)(h).AppearanceInspectDate=e),type:"date",placeholder:"请选择外观检验日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"外观检验结果",prop:"AppearanceResult"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:(0,o.SU)(h).AppearanceResult,"onUpdate:modelValue":i[13]||(i[13]=e=>(0,o.SU)(h).AppearanceResult=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{border:"",label:1},{default:(0,t.w5)((()=>[(0,t.Uk)("合格")])),_:1}),(0,t.Wm)(I,{border:"",label:2},{default:(0,t.w5)((()=>[(0,t.Uk)("不合格")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,t.Wm)((0,o.SU)(v.d0),{class:"uploadDialog",modelValue:X.value,"onUpdate:modelValue":i[19]||(i[19]=e=>X.value=e),title:"图纸上传"},{footer:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{onClick:i[17]||(i[17]=e=>ie("drawingchange")),disabled:ne.value},{default:(0,t.w5)((()=>[(0,t.Uk)("升版")])),_:1},8,["disabled"]),(0,t.Wm)((0,o.SU)(f.ElButton),{type:"success",onClick:i[18]||(i[18]=e=>ie("uploadtableimf")),loading:ne.value},{default:(0,t.w5)((()=>[(0,t.Uk)((0,n.zw)(ne.value?"上传中...":"上传"),1)])),_:1},8,["loading"])])),default:(0,t.w5)((()=>[(0,t.Wm)(T,{ref_key:"uploadRef",ref:ue,class:"upload-demo","on-change":te,"on-exceed":oe,"list-type":"picture","auto-upload":!1,limit:"1","file-list":ae.value},{trigger:(0,t.w5)((()=>[(0,t.Wm)((0,o.SU)(f.ElButton),{type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("选取文件")])),_:1})])),tip:(0,t.w5)((()=>[_])),_:1},8,["file-list"])])),_:1},8,["modelValue"]),(0,t.Wm)((0,o.SU)(v.d0),{modelValue:Q.value,"onUpdate:modelValue":i[21]||(i[21]=e=>Q.value=e),title:"数据下载",width:"600"},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{justify:e.center},{default:(0,t.w5)((()=>[(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{inline:!0},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{label:"时间范围"},{default:(0,t.w5)((()=>[(0,t.Wm)(x,{modelValue:de.value,"onUpdate:modelValue":i[20]||(i[20]=e=>de.value=e),type:"daterange","unlink-panels":"","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",shortcuts:re,"value-format":"YYYY-MM-DD","disabled-date":pe},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{title:"下载VT信息时，时间为必选值、默认下载为总表",type:"warning","show-icon":"",closable:!1})])),_:1}),(0,t.Wm)(s,{span:24},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{data:(0,o.SU)(b)},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{label:"数据名称",prop:"name","show-overflow-tooltip":"",align:"center"}),(0,t.Wm)(c,{label:"操作",align:"center"},{default:(0,t.w5)((e=>[(0,t.Wm)((0,o.SU)(f.ElButton),{link:"",icon:(0,o.SU)(u.UWx),type:"primary",onClick:l=>K(e.row)},{default:(0,t.w5)((()=>[(0,t.Uk)("下载 ")])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"])])),_:1})])),_:1},8,["justify"])])),_:1},8,["modelValue"])],64)}}},S=a(89);const b=(0,S.Z)(h,[["__scopeId","data-v-4c4fa5c9"]]);var y=b}}]);
//# sourceMappingURL=392.4c448178.js.map